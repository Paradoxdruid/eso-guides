<script>
(function() {
  const toggle = document.getElementById('menu-toggle');
  const mobileToc = document.querySelector('.mobile-toc');
  
  if (toggle && mobileToc) {
    // Create overlay element - insert it BEFORE mobileToc in DOM
    const overlay = document.createElement('div');
    overlay.className = 'mobile-toc-overlay';
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 280px;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      display: none;
      pointer-events: auto;
    `;
    
    // Insert overlay before mobileToc to ensure proper stacking
    mobileToc.parentNode.insertBefore(overlay, mobileToc);
    
    // Toggle menu and overlay
    toggle.addEventListener('change', function() {
      if (this.checked) {
        mobileToc.style.right = '0';
        overlay.style.display = 'block';
      } else {
        mobileToc.style.right = '-100%';
        overlay.style.display = 'none';
      }
    });
    
    // Close when clicking overlay
    overlay.addEventListener('click', function() {
      toggle.checked = false;
      mobileToc.style.right = '-100%';
      overlay.style.display = 'none';
    });
    
    // Close menu when clicking internal anchor links
    const links = mobileToc.querySelectorAll('a');
    links.forEach(function(link) {
      link.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href && href.startsWith('#')) {
          setTimeout(function() {
            toggle.checked = false;
            mobileToc.style.right = '-100%';
            overlay.style.display = 'none';
          }, 150);
        }
      });
    });
  }
})();
</script>
